<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Notification</title>
    <base href="/" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" type="image/x-icon" href="favicon.ico" />
  </head>
  <body>
    <app-root></app-root>
    <header>
      <h1>Push Codelab</h1>
    </header>

    <main>
      <p>
        Welcome to the push messaging codelab. The button below needs to be
        fixed to support subscribing to push.
      </p>
      <p>
        <button
          disabled
          class="js-push-btn mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect"
        >
          Enable Push Messaging
        </button>
      </p>
      <section
        class="subscription-details js-subscription-details is-invisible"
      >
        <p>
          Once you've subscribed your user, you'd send their subscription to
          your server to store in a database so that when you want to send a
          message you can lookup the subscription and send a message to it.
        </p>
        <p>
          To simplify things for this code lab copy the following details into
          the
          <a href="https://web-push-codelab.glitch.me/">Push Companion Site</a>
          and it'll send a push message for you, using the application server
          keys on the site - so make sure they match.
        </p>
        <pre><code class="js-subscription-json"></code></pre>
      </section>
    </main>
    <script src="assets/scripts/register-sw.js"></script>
    <script>
      // Retrieve Firebase Messaging object.
      const messaging = firebase.messaging();
      // Add the public key generated from the console here.
      messaging.usePublicVapidKey(
        "BCm7AgT1XTTmjx70GrttR3JX--hIXOMsvCXB1F_UfA3dm0wegB99UOPw90mSist8LJ7QlDhLqIEfDY7rRG_qS8E"
      );

      // Callback fired if Instance ID token is updated.
      messaging.onTokenRefresh(() => {
        messaging
          .getToken()
          .then((refreshedToken) => {
            console.log("Token refreshed.");
            // Indicate that the new Instance ID token has not yet been sent to the
            // app server.
            setTokenSentToServer(false);
            // Send Instance ID token to app server.
            sendTokenToServer(refreshedToken);
            // ...
          })
          .catch((err) => {
            console.log("Unable to retrieve refreshed token ", err);
            showToken("Unable to retrieve refreshed token ", err);
          });
      });
    </script>
  </body>
</html>
